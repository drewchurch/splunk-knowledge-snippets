# CVE-2020-1472 / ZeroLogon SPL for Monitoring Risky Assets



## Insecure NETLOGON Usage Reporting for Remediation (Windows Event Logs XML Format)
```
index=oswin source="XmlWinEventLog:System" EventCode=5829 
| rex field=EventData_Xml "\<Data\>(?P<src_host>[^<]+)<\/\w+><\w+>(?P<src_nt_domain>[^<]+)<\/\w+><\w+>(?P<account_type>[^<]+)<\/\w+><\w+>(?P<os>[^<]+)<\/\w+><\w+>(?P<os_version>[^<]+)<\/\w+><\w+>(?P<os_service_pack>[^<]+)"
| stats earliest(_time) as first_netlogon_warning latest(_time) as last_netlogon_warning by src_host src_nt_domain account_type os os_version os_service_pack
| eval first_netlogon_warning=strftime(first_netlogon_warning, "%x %r") 
| eval last_netlogon_warning=strftime(last_netlogon_warning,"%x %r")
```

## Insecure NETLOGON Usage Reporting for Remediation (Windows Event Logs Classic Format)
```
index=oswin source="WinEventLog:System" EventCode=5829
| rename Machine_SamAccountName as src_host Domain as src_nt_domain Account_Type as account_type Machine_Operating_System as os Machine_Operating_System_Build as os_version Machine_Operating_System_Service_Pack as os_service_pack
| stats earliest(_time) as first_netlogon_warning latest(_time) as last_netlogon_warning by src_host src_nt_domain account_type os os_version os_service_pack
| eval first_netlogon_warning=strftime(first_netlogon_warning, "%x %r") 
| eval last_netlogon_warning=strftime(last_netlogon_warning,"%x %r")
```
